<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Basket Summary</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { display: flex; align-items: center; }
    h1 span { margin-left: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    #qrcode { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>üß∫ <span>Basket Summary</span></h1>
  <div id="cart">Loading basket...</div>
  <div id="qrcode"></div>

  <!-- QRCode.js library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script>
    async function loadBasket() {
      try {
        const res = await fetch("https://sabrina-backend-1-jxzk.onrender.com/getBasket/basket00188");
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) {
          document.getElementById("cart").innerHTML = "üõí Basket is currently empty.";
          return;
        }

        // Build table
        let html = "<table><tr><th>Item</th><th>Price</th><th>Qty</th><th>Subtotal</th></tr>";
        let total = 0;
        data.forEach(item => {
          let subtotal = item.price * item.quantity;
          total += subtotal;
          html += `<tr>
            <td>${item.display_id}</td>
            <td>‚Ç±${item.price.toFixed(2)}</td>
            <td>${item.quantity}</td>
            <td>‚Ç±${subtotal.toFixed(2)}</td>
          </tr>`;
        });
        html += `<tr><td colspan="3"><strong>Total</strong></td><td><strong>‚Ç±${total.toFixed(2)}</strong></td></tr>`;
        html += "</table>";
        document.getElementById("cart").innerHTML = html;

        // Encode basket data into QR code
        let basketPayload = JSON.stringify({items: data, total: total});
        document.getElementById("qrcode").innerHTML = ""; // clear old QR
        new QRCode(document.getElementById("qrcode"), {
          text: basketPayload,
          width: 200,
          height: 200
        });

      } catch (err) {
        document.getElementById("cart").innerHTML = "‚ö†Ô∏è Error loading basket.";
        console.error("Fetch error:", err);
      }
    }

    loadBasket();
  </script>
</body>
</html>
