<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Basket Summary</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { display: flex; align-items: center; }
    h1 span { margin-left: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    #qrcode { margin-top: 20px; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>ðŸ§º <span>Basket Summary</span></h1>
  <div id="cart">Loading basket...</div>
  <button id="checkoutBtn">Checkout</button>
  <div id="qrcode"></div>

  <!-- QRCode.js library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script>
    let basketId = "basket00188"; // fixed for demo, can be dynamic later

    async function loadBasket() {
      try {
        const res = await fetch(`https://sabrina-backend-1-jxzk.onrender.com/getBasket/${basketId}`);
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) {
          document.getElementById("cart").innerHTML = "ðŸ›’ Basket is currently empty.";
          return;
        }

        // Build table
        let html = "<table><tr><th>Item</th><th>Price</th><th>Qty</th><th>Subtotal</th></tr>";
        let total = 0;
        data.forEach(item => {
          let subtotal = item.price * item.quantity;
          total += subtotal;
          html += `<tr>
            <td>${item.display_id}</td>
            <td>â‚±${item.price.toFixed(2)}</td>
            <td>${item.quantity}</td>
            <td>â‚±${subtotal.toFixed(2)}</td>
          </tr>`;
        });
        html += `<tr><td colspan="3"><strong>Total</strong></td><td><strong>â‚±${total.toFixed(2)}</strong></td></tr>`;
        html += "</table>";
        document.getElementById("cart").innerHTML = html;

      } catch (err) {
        document.getElementById("cart").innerHTML = "âš ï¸ Error loading basket.";
        console.error("Fetch error:", err);
      }
    }

    // Checkout button handler
    document.getElementById("checkoutBtn").addEventListener("click", () => {
      document.getElementById("qrcode").innerHTML = ""; // clear old QR
      new QRCode(document.getElementById("qrcode"), {
        text: `https://your-pos-page.com/?basket=${basketId}`, // âœ… phone opens POS page
        width: 200,
        height: 200
      });
    });

    loadBasket();
  </script>
</body>
</html>
